<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="./style.css">

    <!-- for tests, DO NOT MODIFY next line -->
    <link rel="stylesheet" href="https://unpkg.com/mocha/mocha.css"/>
</head>
<body>

<!-- DO NOT MODIFY THESE LINES -->
<!-- START tests -->
<div id="tests" class="container">
    <button onclick="mocha.run()">run tests</button>
    <div id="mocha"></div>

    <script src="https://unpkg.com/chai/chai.js"></script>
    <script src="https://unpkg.com/mocha/mocha.js"></script>

    <script class="mocha-init">
        chai.config.includeStack = false
        chai.config.showDiff = false
        console.log(chai.config)
        mocha.setup('bdd');
        // mocha.checkLeaks();


    </script>
    <script src="./tests.js"></script>
</div>
<!-- END tests -->
<!-- You can modify lines after this -->
<div id="app">
    <div id="user_container" class="container">
        <input type="text" id="username" placeholder="what's your name?">
    </div>
    <div id="post_container" class="container">
        <textarea id="post_text" placeholder="hey, what's up?"></textarea>
        <button id="new_post" onclick="newPost()">post</button>
    </div>
    <div class="container">
        my posts
        <div id="posts">

        </div>
    </div>

    <script type="text/javascript" src="./index.js"></script>
    <script>
        function testRequest() {
            const xhr = new XMLHttpRequest();
            xhr.open("POST", 'http://localhost:3939', true);

//Send the proper header information along with the request
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

            xhr.onreadystatechange = function () { // Call a function when the state changes.
                if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
                    // Request finished. Do processing here.
                    console.log(xhr.response)
                }
            }
            xhr.send(JSON.stringify(testResults));
// xhr.send(new Int8Array());
// xhr.send(document);
        }

        const testResults = []
        // TODO better message
        mocha.run()
            .on('pass', function (test) {
                testResults.push({
                    passed: true,
                    message: test.title
                })
            })
            .on('fail', function (test, err) {
                testResults.push({
                    passed: false,
                    message: test.title,
                    error: err.message
                })
            })
            .on('end', testRequest)
    </script>
</div>
</body>
</html>
